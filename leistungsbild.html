<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leistungsbild</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #fff;
      color: #000;
      margin: 0;
      padding: 2rem;
    }

    header {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 40px;
      max-width: 300px;
      width: 100%;
      text-align: justify;
    }

    .container {
      max-width: 300px;
      margin: 0 auto;
      text-align: center;
    }

    .back-arrow {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 24px;
      color: #800020;
      text-decoration: none;
      font-weight: bold;
    }

    .question {
      margin: 2rem 0 1rem;
      font-weight: bold;
      cursor: pointer;
    }

    .options, .dropdown, .checkbox-group {
      margin-bottom: 2rem;
    }

    .option-button {
      background: none;
      border: none;
      color: #000;
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-size: 1rem;
    }

    .option-button.selected {
      color: #800020;
      border-bottom: 1px solid #800020;
    }

    .hidden {
      display: none;
    }

    select {
      font-family: 'Poppins', sans-serif;
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      background: none;
      border: none;
      border-bottom: 1px solid #000;
      appearance: none;
      cursor: pointer;
      margin-bottom: 0.5rem;
      color: #000;
    }

    select.selected {
      color: #800020;
      border-bottom: 1px solid #800020;
      font-weight: bold;
    }

    .underline {
      height: 1px;
      background-color: #800020;
      margin-top: -0.25rem;
      margin-bottom: 1.5rem;
    }

    .checkbox-group {
      text-align: left;
    }

    .checkbox-group label {
      display: block;
      margin: 0.25rem 0;
      cursor: pointer;
    }

    .checkbox-group input[type="checkbox"] {
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="back-arrow" onclick="window.location.href='index.html'">&larr;</div>
  <header>leistungsbild</header>

  <div class="container">
    <!-- Fragenbereiche (q1–q6 + Zeit & Zusammenfassung) -->
    <!-- ... Denselben Aufbau wie bisher beibehalten, aus Platzgründen hier ausgelassen ... -->
    <!-- Du kannst den strukturellen Teil aus deiner Datei übernehmen, er bleibt unverändert -->

    <!-- Zusammenfassung -->
    <div class="question hidden" id="summaryTitle">Zusammenfassung Ihrer Angaben</div>
    <div class="hidden" id="summaryOutput" style="text-align: left; font-size: 0.9rem; line-height: 1.4; margin-bottom: 2rem; border-top: 1px solid #000; padding-top: 1rem;"></div>

    <!-- Angebotsanfrage Button -->
    <div class="hidden" id="submitBtn">
      <a id="mailtoBtn" href="#" style="display: inline-block; background: none; color: #800020; border: none; font-weight: bold; text-decoration: underline; cursor: pointer;">Angebot jetzt anfordern</a>
    </div>
  </div>

  <!-- Funktionaler JavaScript-Block -->
  <script>
    function selectOption(button, nextId) {
      const parent = button.parentElement;
      const buttons = parent.querySelectorAll('.option-button');
      buttons.forEach(btn => {
        btn.classList.remove('selected', 'hidden');
        if (btn !== button) btn.classList.add('hidden');
      });
      button.classList.add('selected');
      showSection(nextId);
    }

    function showSection(id) {
      const section = document.getElementById(id);
      const label = section?.previousElementSibling;
      if (section) section.classList.remove('hidden');
      if (label) label.classList.remove('hidden');
    }

    function resetOptions(id) {
      const allContainers = document.querySelectorAll('.options, .dropdown, .checkbox-group, .question');
      allContainers.forEach(container => {
        const isFirst = container.id === 'q1' || container.previousElementSibling?.textContent === 'Was brauchst du?';
        if (isFirst) {
          container.classList.remove('hidden');
          const buttons = container.querySelectorAll('.option-button');
          buttons.forEach(btn => btn.classList.remove('selected', 'hidden'));
        } else {
          container.classList.add('hidden');
        }
        const buttons = container.querySelectorAll('.option-button');
        buttons.forEach(btn => btn.classList.remove('selected', 'hidden'));
        const selects = container.querySelectorAll('select');
        selects.forEach(select => {
          select.selectedIndex = 0;
          select.classList.remove('selected');
        });
        const checkboxes = container.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        const underlines = container.querySelectorAll('.underline');
        underlines.forEach(line => line.remove());
      });
    }

    function revealNext(nextId) { showSection(nextId); }

    function checkSize(value) {
      if (value === 'unklar') {
        showSection('q_size_hint');
        showSection('q_size_hint_dropdown');
      } else {
        showSection('q4');
      }
    }

    function checkPlans(value) {
      const createSection = document.getElementById('q_pläne_erstellen');
      const createDropdown = document.getElementById('q_pläne_erstellen_dropdown');
      if (value === 'nein' || value === 'unvollständig') {
        showSection('q_pläne_erstellen');
        showSection('q_pläne_erstellen_dropdown');
      } else {
        createSection.classList.add('hidden');
        createDropdown.classList.add('hidden');
        const select = createDropdown.querySelector('select');
        if (select) {
          select.selectedIndex = 0;
          select.classList.remove('selected');
        }
      }
      showSection('q5');
    }

    function checkPlanningDepth(value) {
      const vergabeQ = document.getElementById('q_vergabe');
      const vergabeDropdown = document.getElementById('q_vergabe_dropdown');
      if (value === 'vergabe' || value === 'vollständig') {
        showSection('q_vergabe');
        showSection('q_vergabe_dropdown');
      } else {
        vergabeQ.classList.add('hidden');
        vergabeDropdown.classList.add('hidden');
        const select = vergabeDropdown.querySelector('select');
        if (select) {
          select.selectedIndex = 0;
          select.classList.remove('selected');
        }
      }
      showSection('q6');
    }

    document.querySelectorAll('#q6 input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', () => {
        const anyChecked = [...document.querySelectorAll('#q6 input[type="checkbox"]')].some(cb => cb.checked);
        if (anyChecked) {
          showSection('q_time');
          showSection('q_time_dropdown');
        }
      });
    });

    document.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', function () {
        if (this.value) {
          this.classList.add('selected');
          if (!this.nextElementSibling || !this.nextElementSibling.classList.contains('underline')) {
            const line = document.createElement('div');
            line.classList.add('underline');
            this.parentNode.insertBefore(line, this.nextSibling);
          }
        }
      });
    });

    function generateSummary() {
      const summary = [];
      const getText = selector => {
        const el = document.querySelector(selector);
        return el?.value || el?.innerText || '';
      };

      const needs = document.querySelector('#q1 .option-button.selected')?.innerText || '';
      const status = document.querySelector('#q2 .option-button.selected')?.innerText || '';
      const support = document.querySelector('#q_support select')?.value || '';
      const size = document.querySelector('#q3 select')?.value || '';
      const plans = document.querySelector('#q4 select')?.value || '';
      const createPlans = document.querySelector('#q_pläne_erstellen_dropdown select')?.value || '';
      const depth = document.querySelector('#q5 select')?.value || '';
      const vergabe = document.querySelector('#q_vergabe_dropdown select')?.value || '';
      const extras = [...document.querySelectorAll('#q6 input[type="checkbox"]:checked')].map(cb => cb.parentElement.innerText.trim());
      const time = document.getElementById('projectTime').value;

      summary.push(`<strong>Was wird benötigt:</strong> ${needs}`);
      summary.push(`<strong>Projektstatus:</strong> ${status}`);
      if (support) summary.push(`<strong>Art der Unterstützung:</strong> ${support}`);
      summary.push(`<strong>Projektgröße:</strong> ${size}`);
      summary.push(`<strong>Pläne vorhanden:</strong> ${plans}`);
      if (plans === 'Nein' || plans === 'Unzureichend') summary.push(`<strong>Pläne erstellen:</strong> ${createPlans}`);
      summary.push(`<strong>Planungstiefe:</strong> ${depth}`);
      if (depth === 'vergabe' || depth === 'vollständig') summary.push(`<strong>Vergabeleistung gewünscht:</strong> ${vergabe}`);
      if (extras.length > 0) summary.push(`<strong>Besondere Anforderungen:</strong> ${extras.join(', ')}`);
      summary.push(`<strong>Geplanter Projektbeginn:</strong> ${time}`);

      const lphs = new Set();
      if (status.includes("fange") || support) lphs.add(0);
      if (status.includes("fange") || support || plans === "Nein" || plans === "Unzureichend") lphs.add(1);
      if (support || status.includes("grobe") || plans === "Nein" || plans === "Unzureichend") lphs.add(2);
      if (status.includes("ziemlich")) lphs.add(3);
      if (depth === "bauantrag") lphs.add(4);
      if (depth === "ausführung") { lphs.add(4); lphs.add(5); }
      if (depth === "vollständig") { lphs.add(4); lphs.add(5); lphs.add(6); lphs.add(7); }
      if (depth === "vergabe" || vergabe === "Ja") { lphs.add(6); lphs.add(7); }

      const full = new Set(lphs);
      const list = [...full];
      const max = Math.max(...list);
      for (let i = 1; i < max; i++) {
        if (full.has(i - 1) && full.has(i + 1)) full.add(i);
      }
      const final = [...full].sort((a, b) => a - b).map(n => `LPH ${n}`);
      if (final.length > 0) summary.push(`<strong>Beauftragte Leistungsphasen:</strong><br>${final.join(", ")}`);

      const summaryHtml = summary.map(line => `<p>${line}</p>`).join('');
      const summaryText = summary.map(line => line.replace(/<[^>]+>/g, '')).join('\n');

      document.getElementById('summaryOutput').innerHTML = summaryHtml;

      const subject = encodeURIComponent("Angebotsanfrage Architekturleistung");
      const body = encodeURIComponent(`Folgende Angaben wurden gemacht:\n\n${summaryText}\n\nBitte senden Sie mir ein unverbindliches Angebot.`);
      document.getElementById('mailtoBtn').href = `mailto:studiolumenarchitektur@gmail.com?subject=${subject}&body=${body}`;

      document.getElementById('summaryTitle').classList.remove('hidden');
      document.getElementById('summaryOutput').classList.remove('hidden');
      document.getElementById('submitBtn').classList.remove('hidden');
    }
  </script>
</body>
</html>
